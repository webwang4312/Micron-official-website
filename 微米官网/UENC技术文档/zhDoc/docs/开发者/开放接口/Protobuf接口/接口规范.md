---
sidebar_position: 1
---
#### 请求数据规范

1. 所有网络请求需按照协议规范（数据格式）将数据组织好后，使用socket连接方式发送到主网节点（端口为11187），当主网节点收到请求后将按照同样协议规范（数据格式）返回给请求方，请求方需自行解析相关数据获得接口返回信息。

2. 请求协议中部分信息是以protobuf方式进行封装，封装后序列化后填充请求协议中进行发送。一般请求协议的名称以Req结尾，发送到主网后，主网后会返回Ack结尾的protobuf数据体进行回应。例如请求获得余额的子协议接口为GetAmountReq，则主网服务器收到该请求后的回应数据体为GetAmountAck。

3. 请求协议的数据格式如下：

    | 协议总长度 |     通用协议     | 校验和 | 标志位 | 结束标志 |
    | :--------: | :--------------: | :----: | :----: | :------: |
    |   4bytes   | 序列化后的字符串 | 4bytes | 4bytes | 4bytes   |

   - 协议总长度

     - 该字段4字节，记录接下来的 **通用协议** + **校验和** + **标志位** + **结束标记**的总长度。假设通用协议100个字节，校验和4个字节，标志位4个字节，结束标记4个字节，则总长度为100 + 4 + 4 + 4 = 112字节。

       - 通用协议

        - 通用协议为profobuf格式，原型如下：

          ```dict
          message CommonMsg
          {
              string version = 1;
              string type = 2;
              int32 encrypt = 3;
              int32 compress = 4;
              bytes data = 5;
          }
          ```

          |   字段   |                             说明                             |
          | :------: | :----------------------------------------------------------: |
          | version  |                     版本号                                     |
          |   type   | 子协议类型名称，根据实际业务需要填充接口名称，如”GetAmountReq” |
          | encrypt  |            是否加密，1为加密，0为不加密，默认为0             |
          | compress |            是否压缩，1为压缩，0为不压缩，默认为0             |
          |   data   | 子协议接口protobuf数据体序列化后的数据,请求时需要将子协议接口的protobuf类型数据序列化后，填充到data中后进行发送。 |


   - 标志位
        
        - 标志位长度为4字节，结构如下：

        |    3     |     2    |    1     |    0     |
        | :------: | :------: | :------: | :------: |
        |   保留   |   保留   |   保留   |  优先级  |

        
        优先级：默认为0。
          
- 校验和

        - 校验和长度为4字节，是通用协议序列化后，通过Adler32算法计算出来的校验和信息。

- 结束标志

        - 结束标记长度为4字节，其内容为7777777。

        4. 将请求协议发送到主网后，主网也按照请求协议格式封装回传信息传送给请求方，请求方收到信息后：

    1. 根据协议总长度获得完整回传信息。
    2. 根据协议总长度获得通用协议、校验和、标志位以及结束标志。
    3. 根据校验和判断通用协议是否完整。
    4. 通过反序列化通用协议，获取子协议（接口）名称和子协议（接口）的数据内容。
    5. 根据通用协议中的压缩和加密字段，确定是否对子协议（接口）的数据内容进行解压缩或解密操作。
    6. 将子协议的数据内容按照子协议的protobuf格式进行反序列化，获得完整的子协议（接口）请求内容。